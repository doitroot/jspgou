webpackJsonp([149],{"5JPI":function(e,t){},zFq2:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("aA9S"),n=s.n(a),i=s("5HJ5"),c=s("x1vo"),r=s("+FNC"),o={nickname:"",page:1,size:10,tagidList:"",black:!1},l={mixins:[i.a],data:function(){return{nameListActive:"fans",fansVisible:!1,addTagVisible:!1,setTagsVisible:!1,form:{tagName:""},percentage:0,selfIndex:-1,timer:null,queryParams:n()({},o),fansTagItems:[],fansTotal:0,checkedTags:[],checkedIds:[],activeTagId:""}},computed:{color:function(){return this.$store.state.system.color}},methods:{validateRepeat:function(e,t,s){this.fansTagItems.forEach(function(e){e.tagName===t&&s(new Error("该标签名已存在，请重新输入"))})},tabsClick:function(e,t){"black"===e.name?(this.queryParams.black=!0,this.queryParams.tagidList=""):this.queryParams.black=!1,this.encodeQuery()},encodeQuery:function(){var e={page:1,size:this.queryParams.size,nickname:""===this.queryParams.nickname?"":Object(c.d)(this.queryParams.nickname),black:this.queryParams.black};this.getTableData(r.t,e)},getTableDataByTagId:function(e){var t={page:1,size:10,nickname:"",tagidList:e};this.queryParams.nickname="",this.activeTagId=e,this.getTableData(r.t,t)},showEmojiName:function(e){var t=Object(c.a)(e);return t=Object(c.c)(t)},showTagNames:function(e){if(0===this.fansTagItems.length)return"[]";if(""===e)return["无标签"];for(var t=this.$cms.arrayToNumber(e),s=[],a=0;a<t.length;a++)for(var n=0;n<this.fansTagItems.length;n++)if(t[a]===this.fansTagItems[n].id){s.push(this.fansTagItems[n].tagName);break}return s},syncFansList:function(){var e=this;this.fansVisible=!0,clearInterval(this.timer),this.timer=null,this.timer=setInterval(this.setPercentage,1e3),Object(r.x)().then(function(t){clearInterval(e.timer),200===t.code?(e.percentage=100,setTimeout(function(){e.$successMessage("同步成功"),e.getTableData(r.t,e.queryParams),e.fansVisible=!1,e.percentage=0},1e3)):(e.$errorMessage(t.message),e.fansVisible=!1)})},syncFansListById:function(){var e=this;if(this.batchStatus){var t=this.$loading({target:".fans__body",text:"正在同步,请稍候.."});Object(r.y)({ids:this.ids}).then(function(s){t.close(),200===s.code?(e.$successMessage("同步成功!"),e.getTableData(r.t,e.queryParams)):(t.close(),e.$errorMessage(s.message))}).catch(function(e){t.close()})}else this.$errorMessage("至少选择一个用户")},syncfansTags:function(){var e=this;Object(r.X)().then(function(t){var s=e.$loading({target:".fans__body",text:"正在同步"});200===t.code?Object(r.z)().then(function(t){e.fansTagItems=t.data.tagList,e.fansTotal=t.data.fansSize,Object(r.t)(e.queryParams).then(function(t){s.close(),e.total=t.data.totalElements,e.tableData=t.data.content,e.$successMessage("同步成功")})}):(s.close(),e.$errorMessage(t.message))})},setPercentage:function(){99===this.percentage?this.percentage=99:this.percentage=this.percentage+1},setFansTags:function(e,t,s){s?(this.checkedTags=this.$cms.arrayToNumber(t),this.checkedIds=[e],this.setTagsVisible=!0):this.batchStatus?(this.checkedIds=this.ids,this.checkedTags=[],this.setTagsVisible=!0):this.$errorMessage("至少选择一条数据")},saveTags:function(){var e=this;Object(r.q)({ids:this.checkedIds,tagid:this.checkedTags}).then(function(t){e.setTagsVisible=!1,200===t.code?(e.$successMessage("设置成功"),e.getFansTags(),e.encodeQuery()):e.$errorMessage(t.message)})},blackFans:function(e){var t=this;this.batchStatus?this.$confirm("加入黑名单后，你将无法接收该用户发来的消息，且该用户无法接收公众号发出的消息，无法参与留言和赞赏，确认加入黑名单?","确认提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.r)({ids:e}).then(function(e){200===e.code?(t.$successMessage("操作成功"),t.encodeQuery()):t.$errorMessage(e.message)})}):this.$errorMessage("至少选择一位粉丝")},returnFans:function(e){var t=this;e.length>0?Object(r.s)({ids:e}).then(function(e){200===e.code?(t.$successMessage("操作成功"),t.encodeQuery()):t.$errorMessage(e.message)}):this.$errorMessage("至少选择一位粉丝")},returnFan:function(e){var t=this;Object(r.s)({ids:[e]}).then(function(e){200===e.code?(t.$successMessage("操作成功"),t.encodeQuery()):t.$errorMessage(e.message)})},getFansTags:function(){var e=this;Object(r.z)().then(function(t){e.fansTagItems=t.data.tagList,e.fansTotal=t.data.fansSize,e.encodeQuery()})},cancelFansTags:function(){this.$refs.form.resetFields(),this.addTagVisible=!1},addFansTags:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;Object(r.p)({tagName:e.form.tagName}).then(function(t){200===t.code?e.fansTagItems.push({id:t.data.id,tagName:t.data.tagName,userCount:t.data.userCount}):e.$errorMessage("新增失败"),e.cancelFansTags()})})},delFansTag:function(e){var t=this;this.$confirm("是否确认删除粉丝标签?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s=t.$loading({target:".fans__body",text:"正在删除..."});Object(r.d)({tagid:e}).then(function(e){200===e.code?(t.$successMessage("删除成功"),t.getFansTags()):t.$errorMessage(e.message),s.close()}).catch(function(e){s.close()})}).catch(function(){return!1})},editFansTag:function(e,t){var s=this;this.$prompt("","粉丝标签修改",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",inputValue:e,inputValidator:function(e){return""===e?"必须输入一个名字":!(e.length>10)||"标签名字不能超过10个字符"}}).then(function(e){var a=e.value,n=s.$loading({target:".fans__body",text:"正在操作"});Object(r.e)({tagid:t,tagname:a}).then(function(e){200===e.code?(s.$successMessage("修改成功"),s.getFansTags()):s.$errorMessage(e.message),n.close()}).catch(function(e){n.close()})}).catch(function(){return!1})}},created:function(){this.getFansTags()}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"cms-list-layout"},[s("el-tabs",{on:{"tab-click":e.tabsClick},model:{value:e.nameListActive,callback:function(t){e.nameListActive=t},expression:"nameListActive"}},[s("el-tab-pane",{attrs:{label:"粉丝列表",name:"fans"}}),e._v(" "),s("el-tab-pane",{attrs:{label:"黑名单",name:"black"}})],1),e._v(" "),s("cms-prompt",{attrs:{collapse:"true"}},[s("li",[e._v("初始绑定公众号，需要进行同步微信粉丝数据")]),e._v(" "),s("li",[e._v("可对当前公众下所有粉丝及标签进行管理")])]),e._v(" "),s("section",{staticClass:"cms-list-query"},[s("div",{staticClass:"query-group"},[s("label",[e._v("粉丝昵称")]),e._v(" "),s("el-input",{nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.encodeQuery(t):null}},model:{value:e.queryParams.nickname,callback:function(t){e.$set(e.queryParams,"nickname","string"==typeof t?t.trim():t)},expression:"queryParams.nickname"}})],1),e._v(" "),s("div",{staticClass:"query-group"},[s("cms-button",{attrs:{size:"small",colorPicker:!0},on:{click:e.encodeQuery}},[e._v("查询")])],1)]),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fans__body"},[s("cms-sticky",{directives:[{name:"show",rawName:"v-show",value:"fans"===e.nameListActive,expression:"nameListActive === 'fans'"}],attrs:{fixClass:"tag__warpper--fixed"}},[s("dl",{staticClass:"fans-tag__warpper"},[s("dt",{staticClass:"fans-tag__header"},[s("span",{staticClass:"fl",on:{click:function(t){e.getTableDataByTagId("")}}},[e._v("全部用户("+e._s(e.fansTotal)+")")]),e._v(" "),s("span",{staticClass:"fr"},[s("i",{staticClass:"el-icon-refresh",attrs:{title:"同步粉丝标签"},on:{click:e.syncfansTags}}),e._v("\n             \n            "),s("el-popover",{attrs:{placement:"bottom",width:"240"},model:{value:e.addTagVisible,callback:function(t){e.addTagVisible=t},expression:"addTagVisible"}},[s("el-form",{ref:"form",attrs:{model:e.form}},[s("el-form-item",{staticClass:"error__inline",attrs:{label:"粉丝标签",prop:"tagName","show-message":!0,rules:[{max:10,message:"最大限制10个字符",trigger:"change"},{validator:function(t,s,a){e.validateRepeat(t,s,a)},trigger:"blur"},{required:!0,message:"标签名称不能为空",trigger:["blur","change"]}]}},[s("el-input",{staticStyle:{width:"100%"},attrs:{autofocus:"",max:10,placeholder:"输入标签名称,最多10个字符"},model:{value:e.form.tagName,callback:function(t){e.$set(e.form,"tagName",t)},expression:"form.tagName"}})],1)],1),e._v(" "),s("div",{staticStyle:{"text-align":"center",margin:"12px 0 0 0"}},[s("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.cancelFansTags}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addFansTags}},[e._v("确定")])],1),e._v(" "),s("i",{staticClass:"el-icon-plus",attrs:{slot:"reference",title:"新增粉丝标签"},slot:"reference"})],1)],1)]),e._v(" "),e._l(e.fansTagItems,function(t){return s("dd",{key:t.id,staticClass:"fans-tag__items",style:{color:e.activeTagId==t.id?e.color:""}},[s("div",{staticClass:"fans-tag__text",on:{click:function(s){e.getTableDataByTagId(t.id)}}},[s("span",{staticClass:"fans-tag__overflow"},[e._v(e._s(t.tagName))]),e._v(" "),s("span",{staticStyle:{display:"inline-block"}},[e._v("("+e._s(t.userCount)+")")])]),e._v(" "),s("div",{staticClass:"fans-tag__opt"},[s("i",{staticClass:"el-icon-edit",on:{click:function(s){e.editFansTag(t.tagName,t.id)}}}),e._v(" "),s("i",{staticClass:"el-icon-close",on:{click:function(s){e.delFansTag(t.id)}}})])])})],2)]),e._v(" "),s("div",{style:"fans"===e.nameListActive?"margin-left:220px;":"margin-left:0px;"},[s("cms-sticky",["fans"===e.nameListActive?s("section",{staticClass:"cms-batch"},[s("cms-button",{attrs:{icon:"add",type:"success",size:"small"},on:{click:function(t){e.setFansTags(e.ids,"",!1)}}},[e._v("设置标签")]),e._v(" "),s("cms-button",{attrs:{icon:"add",type:"success",size:"small"},on:{click:e.syncFansList}},[e._v("同步所有粉丝")]),e._v(" "),s("cms-button",{attrs:{icon:"add",type:"success",size:"small"},on:{click:function(t){e.syncFansListById(e.ids)}}},[e._v("同步选中粉丝")]),e._v(" "),s("cms-button",{attrs:{icon:"error",type:"error",size:"small"},on:{click:function(t){e.blackFans(e.ids)}}},[e._v("加入黑名单")])],1):s("section",{staticClass:"cms-batch"},[s("cms-button",{attrs:{icon:"error",type:"error",size:"small"},on:{click:function(t){e.returnFans(e.ids)}}},[e._v("批量移出黑名单")])],1)]),e._v(" "),s("el-table",{ref:"dataTable",staticStyle:{width:"100%","min-height":"500px"},attrs:{data:e.tableData,stripe:""},on:{"selection-change":e.getCheckItems,"row-click":e.checkRows}},[s("el-table-column",{attrs:{type:"selection",width:"46",fixed:"left"}}),e._v(" "),s("el-table-column",{attrs:{label:"粉丝头像",width:"90",prop:"logo"},scopedSlots:e._u([{key:"default",fn:function(e){return s("div",{staticClass:"fans-img"},[s("img",{attrs:{src:e.row.headimgurl,alt:"nickname"}})])}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"粉丝昵称","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{domProps:{innerHTML:e._s(e.showEmojiName(t.row.nickname))}}),e._v(" "),s("div",{staticClass:"table-tag__body"},[e._l(e.showTagNames(t.row.tagidList),function(a,n){return s("span",{directives:[{name:"show",rawName:"v-show",value:n<5||e.selfIndex===t.$index,expression:"index<5||selfIndex===scope.$index"}],key:n,staticClass:"table-tag__label",on:{click:function(s){s.stopPropagation(),e.setFansTags(t.row.id,t.row.tagidList,!0)}}},[e._v(e._s(a))])}),e._v(" "),e.showTagNames(t.row.tagidList).length>5&&e.selfIndex!==t.$index?s("span",{staticClass:"table-tag__more",on:{click:function(s){s.stopPropagation(),e.selfIndex=t.$index}}},[e._v("共"+e._s(e.showTagNames(t.row.tagidList).length)+"个标签")]):e._e(),e._v(" "),s("i",{staticClass:"el-icon-caret-bottom",on:{click:function(s){s.stopPropagation(),e.setFansTags(t.row.id,t.row.tagidList,!0)}}})],2)]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"initials",label:"关注时间","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.$moment(1e3*t.row.subscribeTime)))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"310",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return s("div",{},["fans"===e.nameListActive?s("cms-button",{directives:[{name:"prem",rawName:"v-prem",value:"/wechatFans/send",expression:"'/wechatFans/send'"}],attrs:{icon:"edit",size:"small",type:"info"},on:{click:function(s){s.stopPropagation(),e.$routerLink("/wechatFans/send","update",{id:t.row.id})}}},[e._v("发送消息")]):s("div",[s("cms-button",{attrs:{icon:"edit",size:"small",type:"info"},on:{click:function(s){s.stopPropagation(),e.$routerLink("/wechatFans/view","view",{id:t.row.id})}}},[e._v("查看历史消息")]),e._v(" "),s("cms-button",{attrs:{icon:"edit",size:"small",type:"info"},on:{click:function(s){e.returnFan(t.row.id)}}},[e._v("移出黑名单")])],1)],1)}}])})],1)],1)],1),e._v(" "),s("cms-pagination",{attrs:{total:e.total},on:{change:e.getPage}}),e._v(" "),s("el-dialog",{attrs:{title:"同步进度",center:"",visible:e.fansVisible,width:"600px",top:"30vh"},on:{"update:visible":function(t){e.fansVisible=t}}},[s("div",{staticClass:"progress__body"},[e._v("正在同步粉丝列表:\n      "),s("el-progress",{attrs:{percentage:e.percentage}})],1)]),e._v(" "),s("el-dialog",{attrs:{title:"设置标签",center:"",visible:e.setTagsVisible,width:"600px",top:"20vh"},on:{"update:visible":function(t){e.setTagsVisible=t}}},[s("div",{staticClass:"tags__body"},[s("el-checkbox-group",{model:{value:e.checkedTags,callback:function(t){e.checkedTags=t},expression:"checkedTags"}},e._l(e.fansTagItems,function(t){return s("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.tagName))])}),1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveTags}},[e._v("确定")]),e._v(" "),s("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(t){e.setTagsVisible=!1}}},[e._v("取消")])],1)])],1)},staticRenderFns:[]};var d=s("C7Lr")(l,u,!1,function(e){s("5JPI")},null,null);t.default=d.exports}});
//# sourceMappingURL=149.8ba6fa7668e4b189d60f.js.map