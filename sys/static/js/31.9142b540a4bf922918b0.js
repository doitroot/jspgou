webpackJsonp([31],{D7Ce:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("aA9S"),r=o.n(a),i=o("x1ym"),n=o("lcoF"),l=o("QkjJ"),s=o("CPCM"),m=o("FemL"),c={promote:{name:"",promoteBeginTime:"",promoteEndTime:"",remark:"",enable:!0,promoteType:4,product_flag_icon:""},rule:{signBeginTime:"",signEndTime:"",signScope:1,oneFeeThird:1,oneFeeSelf:.5,maxRefundRate:.1,minPrice:50,minSale:20,minScore:4.5,minStock:100},discounts:[{conOrderAmount:0,discountAmount:0}],signLimitCtgIds:[],couponIds:[]},u={components:{categoryCascader:s.a,cmsCoupon:m.a},mixins:[n.a],data:function(){return{productLimt:[],activeTimer:[],signTimer:[],formData:r()({},c),rules:{"promote.name":[i.a.required("请填写活动名称"),i.a.len(1,15)],"promote.promoteBeginTime":[i.a.required("请选择活动开始时间","change")],"rule.signBeginTime":[i.a.required("请选择活动报名时间","change")],"rule.oneFeeThird":[i.a.required(),i.a.float(),i.a.decimal()],"rule.oneFeeSelf":[i.a.required(),i.a.float(),i.a.decimal()],"rule.minPrice":[i.a.float(),i.a.decimal()],"rule.minStock":[i.a.number()],"rule.minScore":[i.a.float()],"rule.maxRefundRate":[i.a.float()],"rule.minSale":[i.a.number()]}}},computed:{color:function(){return this.$store.state.system.color}},methods:{changeProductLimt:function(e){e.indexOf(0)>-1&&e.length>1&&(this.productLimt=[])},getCoupon:function(e){this.formData.couponIds=e.map(function(e){return e.id})},changeType:function(e){this.formData.coupon.expirateType=e},getActiveTimer:function(e){this.formData.promote.promoteBeginTime=e[0],this.formData.promote.promoteEndTime=e[1]},getSignTimer:function(e){this.formData.rule.signBeginTime=e[0],this.formData.rule.signEndTime=e[1],this.$refs.activeTimer.setFilterTime(e[1])},discountAdd:function(){this.formData.discounts.push({conOrderAmount:0,discountAmount:0})},discountDelete:function(e){this.formData.discounts.splice(e,1)},save:function(e){var t=this,o=this.$cms.deepCopy(this.formData),a=!0;if(3===o.promote.promoteType){o.couponIds=[];var r=/^(([0-9]*)|(([0]\.\d{1,2}|[0-9]*\.\d{1,2})))$/;o.discounts.forEach(function(e){""===e.conOrderAmount||""===e.discountAmount?(a=!1,t.$errorMessage("满减信息不能为空")):r.test(e.conOrderAmount)&&r.test(e.discountAmount)?parseFloat(e.conOrderAmount)<parseFloat(e.discountAmount)?(a=!1,t.$errorMessage("满减额度必须大于消费额度")):(e.conOrderAmount=parseFloat(e.conOrderAmount),e.discountAmount=parseFloat(e.discountAmount)):(a=!1,t.$errorMessage("满减信息格式不正确"))})}else o.discounts=[];if(-1===this.productLimt.indexOf(1)&&(o.rule.minPrice=0),-1===this.productLimt.indexOf(2)&&(o.rule.minStock=0),-1===this.productLimt.indexOf(3)&&(o.rule.minScore=0),-1===this.productLimt.indexOf(4)&&(o.rule.maxRefundRate=0),-1===this.productLimt.indexOf(5)?o.rule.minSale=0:o.rule.minSale=parseInt(o.rule.minSale),a){var i=new Date(this.signTimer[1]).getTime();new Date(this.activeTimer[0]).getTime()>i?this.saveForm(l.d,o,e,"/activity/list","list").then(function(e){t.activeTimer=[],t.signTimer=[],t.productLimt=""}):this.errorPosition("promote.promoteBeginTime",{"promote.promoteBeginTime":"活动开始时间必须在报名阶段结束之后"})}},reset:function(){window.clearInterval(this.timer),this.autoFocus(),this.$refs.form.resetFields(),this.destroyed(),this.formData=this.$cms.deepCopy(c),this.activeTimer=[],this.signTimer=[],this.productLimt=[]}},created:function(){this.formData=this.$cms.deepCopy(c)}},p={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("cms-breadcrumb",{attrs:{to:"/activity/list",type:"list"},on:{click:e.rest}},[o("li",[e._v(e._s(e.$route.name))])]),e._v(" "),o("div",{staticClass:"cms-form-layout"},[o("cms-prompt",{attrs:{collapse:!1}},[o("li",[e._v("可进行添加平台活动")])]),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.formData,"label-width":"210px"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",{ref:"promote_name",attrs:{label:"活动名称",prop:"promote.name"}},[o("el-input",{model:{value:e.formData.promote.name,callback:function(t){e.$set(e.formData.promote,"name",t)},expression:"formData.promote.name"}})],1),e._v(" "),o("el-form-item",{ref:"rule.signBeginTime",attrs:{label:"报名时间",prop:"rule.signBeginTime",error:e.errorMessage["rule.signBeginTime"]}},[o("cms-picker",{staticStyle:{width:"380px"},attrs:{disabledType:"todayAfter","value-format":"yyyy-MM-dd"},on:{change:e.getSignTimer},model:{value:e.signTimer,callback:function(t){e.signTimer=t},expression:"signTimer"}})],1),e._v(" "),o("el-form-item",{ref:"promote.promoteBeginTime",attrs:{label:"活动时间",prop:"promote.promoteBeginTime",error:e.errorMessage["promote.promoteBeginTime"]}},[o("cms-picker",{ref:"activeTimer",staticStyle:{width:"380px"},attrs:{disabledType:"todayAfter","value-format":"yyyy-MM-dd"},on:{change:e.getActiveTimer},model:{value:e.activeTimer,callback:function(t){e.activeTimer=t},expression:"activeTimer"}})],1),e._v(" "),o("el-form-item",{ref:"promote.remark",attrs:{label:"活动说明",prop:"promote.remark"}},[o("el-input",{attrs:{type:"textarea",rows:4,maxlength:"250"},model:{value:e.formData.promote.remark,callback:function(t){e.$set(e.formData.promote,"remark",t)},expression:"formData.promote.remark"}})],1),e._v(" "),o("el-form-item",{ref:"rule_signScope",attrs:{label:"活动报名限制",prop:"rule.signScope"}},[o("el-radio-group",{model:{value:e.formData.rule.signScope,callback:function(t){e.$set(e.formData.rule,"signScope",t)},expression:"formData.rule.signScope"}},[o("el-radio",{attrs:{label:1}},[e._v("全部商品")]),e._v(" "),o("el-radio",{attrs:{label:2}},[e._v("自营商品")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("部分类目")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===e.formData.rule.signScope,expression:"formData.rule.signScope===3"}],attrs:{label:"选择类目"}},[o("category-cascader",{staticStyle:{width:"380px"},model:{value:e.formData.signLimitCtgIds,callback:function(t){e.$set(e.formData,"signLimitCtgIds",t)},expression:"formData.signLimitCtgIds"}})],1),e._v(" "),o("el-form-item",{ref:"promote.promoteType",attrs:{label:"活动支持优惠形式",prop:"promote.promoteType"}},[o("el-radio-group",{model:{value:e.formData.promote.promoteType,callback:function(t){e.$set(e.formData.promote,"promoteType",t)},expression:"formData.promote.promoteType"}},[o("el-radio",{attrs:{label:4}},[e._v("优惠券")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("满减")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:4==e.formData.promote.promoteType,expression:"formData.promote.promoteType==4"}],attrs:{label:"选择优惠券"}},[e.status?o("cms-coupon",{attrs:{type:1,hasPromote:!1},on:{get:e.getCoupon},model:{value:e.formData.couponIds,callback:function(t){e.$set(e.formData,"couponIds",t)},expression:"formData.couponIds"}}):e._e()],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3==e.formData.promote.promoteType,expression:"formData.promote.promoteType==3"}],attrs:{label:"满减信息"}},[o("ul",[e._l(e.formData.discounts,function(t,a){return o("li",{key:a,staticStyle:{"margin-bottom":"10px"}},[o("el-input",{staticStyle:{width:"160px","margin-right":"5px"},attrs:{type:"number",oninput:"if(value.length>9)value=value.slice(0,9)"},model:{value:t.conOrderAmount,callback:function(o){e.$set(t,"conOrderAmount",o)},expression:"item.conOrderAmount"}},[o("template",{slot:"prepend"},[e._v("满")])],2),e._v(" "),o("el-input",{staticStyle:{width:"160px"},attrs:{type:"number",oninput:"if(value.length>9)value=value.slice(0,9)"},model:{value:t.discountAmount,callback:function(o){e.$set(t,"discountAmount",o)},expression:"item.discountAmount"}},[o("template",{slot:"prepend"},[e._v("减")])],2),e._v(" "),0!=a?o("span",{staticClass:"del-span",on:{click:function(t){e.discountDelete(a)}}},[e._v("删除")]):e._e()],1)}),e._v(" "),o("div",{staticClass:"discounts__add",style:{color:e.color},on:{click:function(t){e.discountAdd()}}},[o("span",{staticClass:"iconfont icon-tianjia"}),e._v("添加")])],2)]),e._v(" "),o("el-form-item",{ref:"rule.oneFeeThird",attrs:{label:"自营店铺单品收费",prop:"rule.oneFeeThird"}},[o("el-input",{attrs:{maxlength:"6"},model:{value:e.formData.rule.oneFeeThird,callback:function(t){e.$set(e.formData.rule,"oneFeeThird",t)},expression:"formData.rule.oneFeeThird"}},[o("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),o("el-form-item",{ref:"rule.oneFeeSelf",attrs:{label:"非自营店铺单品收费",prop:"rule.oneFeeSelf"}},[o("el-input",{attrs:{maxlength:"6"},model:{value:e.formData.rule.oneFeeSelf,callback:function(t){e.$set(e.formData.rule,"oneFeeSelf",t)},expression:"formData.rule.oneFeeSelf"}},[o("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),o("h3",{staticClass:"cms-segmentation"},[e._v("商品报名限制")]),e._v(" "),o("el-form-item",{attrs:{label:"商品报名限制"}},[o("el-select",{attrs:{multiple:"",size:"mini"},on:{change:e.changeProductLimt},model:{value:e.productLimt,callback:function(t){e.productLimt=t},expression:"productLimt"}},[o("el-option",{attrs:{value:0,label:"无限制"}}),e._v(" "),o("el-option",{attrs:{value:1,label:"最新30天成交价"}}),e._v(" "),o("el-option",{attrs:{value:2,label:"库存"}}),e._v(" "),o("el-option",{attrs:{value:3,label:"商品评分"}}),e._v(" "),o("el-option",{attrs:{value:4,label:"退款率"}}),e._v(" "),o("el-option",{attrs:{value:5,label:"最新30天销量"}})],1)],1),e._v(" "),e.productLimt.indexOf(1)>-1?o("el-form-item",{ref:"rule.minPrice",attrs:{label:"最新30天成交价>=",prop:"rule.minPrice"}},[o("el-input",{attrs:{maxlength:"6"},model:{value:e.formData.rule.minPrice,callback:function(t){e.$set(e.formData.rule,"minPrice",t)},expression:"formData.rule.minPrice"}},[o("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),e._v(" "),e.productLimt.indexOf(2)>-1?o("el-form-item",{ref:"rule.minStock",attrs:{label:"库存>=",prop:"rule.minStock"}},[o("el-input",{attrs:{maxlength:"6"},model:{value:e.formData.rule.minStock,callback:function(t){e.$set(e.formData.rule,"minStock",t)},expression:"formData.rule.minStock"}},[o("template",{slot:"append"},[e._v("件")])],2)],1):e._e(),e._v(" "),e.productLimt.indexOf(3)>-1?o("el-form-item",{ref:"rule.minScore",attrs:{label:"商品评分>=",prop:"rule.minScore"}},[o("el-input",{attrs:{maxlength:"4"},model:{value:e.formData.rule.minScore,callback:function(t){e.$set(e.formData.rule,"minScore",t)},expression:"formData.rule.minScore"}},[o("template",{slot:"append"},[e._v("分")])],2)],1):e._e(),e._v(" "),e.productLimt.indexOf(4)>-1?o("el-form-item",{ref:"rule.maxRefundRate",attrs:{label:"退款率<=",prop:"rule.maxRefundRate"}},[o("el-input",{attrs:{maxlength:"4"},model:{value:e.formData.rule.maxRefundRate,callback:function(t){e.$set(e.formData.rule,"maxRefundRate",t)},expression:"formData.rule.maxRefundRate"}},[o("template",{slot:"append"},[e._v("%")])],2)],1):e._e(),e._v(" "),e.productLimt.indexOf(5)>-1?o("el-form-item",{ref:"rule.minSale",attrs:{label:"最新30天销量>=",prop:"rule.minSale"}},[o("el-input",{attrs:{maxlength:"6"},model:{value:e.formData.rule.minSale,callback:function(t){e.$set(e.formData.rule,"minSale",e._n(t))},expression:"formData.rule.minSale"}},[o("template",{slot:"append"},[e._v("件")])],2)],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:"活动检索标识",prop:"promote.product_flag_icon"}},[e.status?o("cms-picture-zone",{model:{value:e.formData.promote.product_flag_icon,callback:function(t){e.$set(e.formData.promote,"product_flag_icon",t)},expression:"formData.promote.product_flag_icon"}}):e._e()],1),e._v(" "),o("el-form-item",{ref:"promote.enable",attrs:{label:"是否上线",prop:"promote.enable"}},[o("cms-switch",{model:{value:e.formData.promote.enable,callback:function(t){e.$set(e.formData.promote,"enable",t)},expression:"formData.promote.enable"}})],1)],1),e._v(" "),o("div",{staticClass:"cms-form-footer"},[o("cms-button",{directives:[{name:"color",rawName:"v-color"}],on:{click:function(t){e.save(!1)}}},[e._v("保存并新增")]),e._v(" "),o("cms-button",{directives:[{name:"color",rawName:"v-color"}],on:{click:function(t){e.save(!0)}}},[e._v("保存")]),e._v(" "),o("cms-button",{attrs:{type:"rest"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1)},staticRenderFns:[]};var d=o("C7Lr")(u,p,!1,function(e){o("Hj9d")},"data-v-6326e342",null);t.default=d.exports},FemL:function(e,t,o){"use strict";var a=o("QkjJ"),r={mixins:[o("5HJ5").a],name:"cmsCoupon",props:{value:{},multiple:{type:Boolean,default:!0},labelName:{type:String,default:"name"},type:{type:Number,default:""},hasPromote:{type:Boolean,default:""},data:{type:Array,default:function(){return[]}}},watch:{data:{handler:function(){this.checkItems=this.$cms.deepCopy(this.data),this.showItems=this.$cms.deepCopy(this.data)},immediate:!0,deep:!0}},data:function(){return{dialogVisible:!1,checkItems:[],selectIndex:"",queryParams:{name:"",discountAmount:"",beginTime:"",endTime:"",couponType:"",hasPromote:"",page:1,size:10},showItems:[]}},methods:{initData:function(){this.dialogVisible=!0,this.queryParams.couponType=this.type,this.queryParams.hasPromote=this.hasPromote,this.getTableData(a.y,this.queryParams)},checkRows:function(e){this.multiple?this.$refs.dataTable.toggleRowSelection(e):(this.selectIndex=this.tableData.indexOf(e),this.checkItems=[e])},determine:function(){this.$emit("get",this.checkItems),this.multiple?this.$emit("input",this.checkItems.map(function(e){return e.id})):this.$emit("input",parseInt(this.checkItems.map(function(e){return e.id}).toString())),this.showItems=this.$cms.deepCopy(this.checkItems),this.close()},deleteCoupon:function(e){this.showItems.splice(e,1),this.checkItems.splice(e,1),this.$emit("get",this.checkItems),this.multiple?this.$emit("input",this.checkItems.map(function(e){return e.id})):this.$emit("input",parseInt(this.checkItems.map(function(e){return e.id}).toString()))},close:function(e){this.checkItems=[],this.selectIndex="",this.$refs.dataTable.clearSelection(),this.dialogVisible=!1}}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.initData}},[e._v("选择优惠券")]),e._v(" "),o("el-dialog",{attrs:{title:"优惠券选择",visible:e.dialogVisible,width:"70%","before-close":e.close}},[o("div",{staticClass:"cms-dialog__body"},[o("section",{staticClass:"cms-list-query"},[o("div",{staticClass:"query-group"},[o("label",[e._v("优惠券名称")]),e._v(" "),o("el-input",{nativeOn:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.query(t):null}},model:{value:e.queryParams.name,callback:function(t){e.$set(e.queryParams,"name",t)},expression:"queryParams.name"}})],1),e._v(" "),o("div",{staticClass:"query-group"},[o("cms-button",{attrs:{size:"small",colorPicker:!0},on:{click:e.query}},[e._v("查询")])],1)]),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataTable",staticStyle:{cursor:"pointer"},attrs:{"element-loading-text":"正在加载...",data:e.tableData},on:{"selection-change":e.getCheckItems,"row-click":e.checkRows}},[e.multiple?o("el-table-column",{attrs:{width:"60",type:"selection"}}):o("el-table-column",{attrs:{width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return o("div",{},[o("el-radio",{attrs:{label:t.$index,disabled:e.canSelecteAll},model:{value:e.selectIndex,callback:function(t){e.selectIndex=t},expression:"selectIndex"}},[e._v(" ")])],1)}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"id",label:"id",width:"60"}}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:"优惠券名称","min-width":"200","show-overflow-tooltip":"","class-name":"text-overflow"}}),e._v(" "),o("el-table-column",{attrs:{prop:"couponType",label:"类型",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return o("div",{},[1==t.row.couponType?o("span",{staticClass:"info"},[e._v("活动优惠券")]):e._e(),e._v(" "),2==t.row.couponType?o("span",{staticClass:"success"},[e._v("普通优惠券")]):e._e()])}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"discountAmount",label:"面值"}}),e._v(" "),o("el-table-column",{attrs:{prop:"discountAmount",label:"使用条件","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return o("div",{},[o("span",[e._v("满"+e._s(t.row.conOrderAmount)+"减"+e._s(t.row.discountAmount))])])}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"discountAmount",label:"使用期限","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){return o("div",{},[1==t.row.expirateType?o("span",[e._v(e._s(e.$moment(t.row.useBeginTime,"YYYY-MM-DD"))+" 至 \n              "+e._s(e.$moment(t.row.useEndTime,"YYYY-MM-DD"))+"\n            ")]):e._e(),e._v(" "),2==t.row.expirateType?o("span",[e._v("派发后"+e._s(t.row.useDay)+"天")]):e._e()])}}])})],1),e._v(" "),o("cms-pagination",{attrs:{total:e.total},on:{change:e.getPage}})],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.determine}},[e._v("确 定")]),e._v(" "),o("el-button",{attrs:{type:"info",size:"mini"},on:{click:e.close}},[e._v("取 消")])],1)]),e._v(" "),o("ul",{staticClass:"coupon__items"},e._l(e.showItems,function(t,a){return o("li",{key:t.id,staticClass:"coupon__item"},[o("span",{staticClass:"coupon__name text-overflow"},[e._v(e._s(t.name))]),e._v(" "),o("span",{staticClass:"coupon__del",on:{click:function(t){e.deleteCoupon(a)}}},[e._v("删除")])])}),0)],1)},staticRenderFns:[]};var n=o("C7Lr")(r,i,!1,function(e){o("XEj3")},"data-v-bd7a2062",null);t.a=n.exports},Hj9d:function(e,t){},XEj3:function(e,t){}});
//# sourceMappingURL=31.9142b540a4bf922918b0.js.map