webpackJsonp([58],{wn45:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o("aA9S"),a=o.n(r),m=o("x1ym"),p=o("lcoF"),s=o("QkjJ"),c=o("CPCM"),i=o("FemL"),n=o("q8bx"),l={promote:{name:"",promoteBeginTime:"",promoteEndTime:"",conType:1,promoteScope:1,discountMode:2,conOrderAmount:1,discountAmount:1,remark:"",conProductNum:0,enable:!0,promoteType:""},products:[{specialPrice:"",productId:"",discount:"",limitNum:""}],ctgIds:[],includeProductIds:[],excludeProductIds:[],couponIds:[],giveProductIds:[],giveCouponIds:[],storeServices:[]},u={components:{categoryCascader:c.a,cmsCoupon:i.a,cmsProduct:n.a},mixins:[p.a],data:function(){var t=this;return{proStatus:!1,productLimt:[],activeTimer:[],formData:a()({},l),discountData:[],storeServices:[],rules:{"promote.name":[m.a.required("请填写活动名称"),m.a.len(1,15)],"promote.promoteBeginTime":[m.a.required("请选择活动开始时间","change")],"promote.promoteScope":[m.a.required()],"promote.promoteType":[m.a.required("此项必填","change")],"promote.conOrderAmount":[m.a.number()],"promote.discountAmount":[m.a.integer(),m.a.custom(function(e,o,r){o>t.formData.promote.conOrderAmount&&r(new Error("优惠金额不得大于满值金额"))})],"promote.conProductNum":[m.a.required()]}}},methods:{deleteDiscountData:function(t){this.discountData.splice(t,1)},getProductDiscount:function(t){var e=[];t.forEach(function(t){var o={product:{coverImage:t.product.coverImage,id:t.product.id,name:t.product.name,salePrice:t.product.salePrice,specialPrice:t.product.salePrice,discount:9.5,limitNum:1}};e.push(o)}),this.discountData=e},changePromoteType:function(t){1===t&&(this.formData.promote.promoteScope=1),6===t&&(this.formData.promote.conType=1)},getActiveTimer:function(t){this.formData.promote.promoteBeginTime=t[0],this.formData.promote.promoteEndTime=t[1]},save:function(t){var e=this.$cms.deepCopy(this.formData);if(e.promote.promoteType<=2){var o=[];this.discountData.forEach(function(t){var r={specialPrice:2===e.promote.promoteType?t.product.specialPrice:"",productId:t.product.id,discount:1===e.promote.promoteType?t.product.discount:"",limitNum:t.product.limitNum};o.push(r)}),e.products=o}this.saveForm(s.g,e,t,"/storeActivity/list","list").then(function(t){})},restSel:function(){var t=this;this.proStatus=!1,setTimeout(function(){t.proStatus=!0},3)},getStoreService:function(){var t=this;Object(s.v)().then(function(e){200===e.code&&(t.storeServices=e.data)})},serFilter:function(t){return["","单品折扣","单品一口价","满减","优惠券","满赠","包邮"][parseInt(t)]},restData:function(){window.clearInterval(this.timer),this.rest(),this.formData=this.$cms.deepCopy(l),this.activeTimer=[],this.proStatus=!1}},created:function(){this.formData=this.$cms.deepCopy(l),this.getStoreService()}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("cms-breadcrumb",{attrs:{to:"/storeActivity/list",type:"list"},on:{click:t.rest}},[o("li",[t._v(t._s(t.$route.name))])]),t._v(" "),o("div",{staticClass:"cms-form-layout"},[o("cms-prompt",{attrs:{collapse:!1}},[o("li",[t._v("可进行添加商家活动")])]),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",staticClass:"the-form",attrs:{rules:t.rules,model:t.formData,"label-width":"210px"},nativeOn:{submit:function(t){t.preventDefault()}}},[o("el-form-item",{ref:"promote_name",attrs:{label:"活动名称",prop:"promote.name"}},[o("el-input",{model:{value:t.formData.promote.name,callback:function(e){t.$set(t.formData.promote,"name",e)},expression:"formData.promote.name"}})],1),t._v(" "),o("el-form-item",{ref:"promote.promoteBeginTime",attrs:{label:"活动时间",prop:"promote.promoteBeginTime",error:t.errorMessage["promote.promoteBeginTime"]}},[o("cms-picker",{staticStyle:{width:"380px"},attrs:{disabledType:"before"},on:{change:t.getActiveTimer},model:{value:t.activeTimer,callback:function(e){t.activeTimer=e},expression:"activeTimer"}})],1),t._v(" "),o("el-form-item",{ref:"promote.remark",attrs:{label:"活动说明",prop:"promote.remark"}},[o("el-input",{attrs:{type:"textarea",rows:4,maxlength:"100"},model:{value:t.formData.promote.remark,callback:function(e){t.$set(t.formData.promote,"remark",e)},expression:"formData.promote.remark"}})],1),t._v(" "),o("el-form-item",{ref:"promote.promoteType",attrs:{label:"活动支持优惠形式",prop:"promote.promoteType"}},[o("el-select",{attrs:{"no-data-text":"暂无可用活动类型，请前往营销服务开通"},on:{change:t.changePromoteType},model:{value:t.formData.promote.promoteType,callback:function(e){t.$set(t.formData.promote,"promoteType",e)},expression:"formData.promote.promoteType"}},t._l(t.storeServices,function(e,r){return o("el-option",{key:r,attrs:{label:t.serFilter(e.promoteType),value:e.promoteType}})}),1)],1),t._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.formData.promote.promoteType>2,expression:"(formData.promote.promoteType>2)"}],ref:"promote.promoteScope",attrs:{label:"活动商品",prop:"promote.promoteScope"}},[o("el-radio-group",{on:{change:t.restSel},model:{value:t.formData.promote.promoteScope,callback:function(e){t.$set(t.formData.promote,"promoteScope",e)},expression:"formData.promote.promoteScope"}},[o("el-radio",{attrs:{label:1}},[t._v("全部商品")]),t._v(" "),o("el-radio",{attrs:{label:2}},[t._v("部分类目")]),t._v(" "),o("el-radio",{attrs:{label:3}},[t._v("部分商品")]),t._v(" "),o("el-radio",{attrs:{label:4}},[t._v("排除商品")])],1)],1),t._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2===t.formData.promote.promoteScope,expression:"formData.promote.promoteScope===2"}],attrs:{label:"选择类目"}},[o("category-cascader",{staticStyle:{width:"380px"},model:{value:t.formData.ctgIds,callback:function(e){t.$set(t.formData,"ctgIds",e)},expression:"formData.ctgIds"}})],1),t._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===t.formData.promote.promoteScope,expression:"formData.promote.promoteScope===3"}],attrs:{label:"选择商品"}},[t.proStatus?o("cms-product",{attrs:{type:"product"},model:{value:t.formData.includeProductIds,callback:function(e){t.$set(t.formData,"includeProductIds",e)},expression:"formData.includeProductIds"}}):t._e()],1),t._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:4===t.formData.promote.promoteScope,expression:"formData.promote.promoteScope===4"}],attrs:{label:"选择商品"}},[t.proStatus?o("cms-product",{attrs:{type:"product"},model:{value:t.formData.excludeProductIds,callback:function(e){t.$set(t.formData,"excludeProductIds",e)},expression:"formData.excludeProductIds"}}):t._e()],1),t._v(" "),t.formData.promote.promoteType<=2?o("div",[o("el-form-item",{staticClass:"default",attrs:{label:"活动条件",prop:"promote.conProductNum"}},[o("el-radio-group",{model:{value:t.formData.promote.conType,callback:function(e){t.$set(t.formData.promote,"conType",e)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conProductNum,callback:function(e){t.$set(t.formData.promote,"conProductNum",e)},expression:"formData.promote.conProductNum"}},[o("template",{slot:"prepend"},[t._v("满")]),t._v(" "),o("template",{slot:"append"},[t._v("件")])],2)],1),t._v(" "),o("el-radio",{attrs:{label:3}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conProductNum,callback:function(e){t.$set(t.formData.promote,"conProductNum",e)},expression:"formData.promote.conProductNum"}},[o("template",{slot:"prepend"},[t._v("第")]),t._v(" "),o("template",{slot:"append"},[t._v("件")])],2)],1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:1==t.formData.promote.promoteType?"设置折扣":"设置一口价"}},[o("cms-product",{attrs:{type:"product",show:!1},on:{get:t.getProductDiscount}}),t._v(" "),t.discountData.length>0?o("table",{staticClass:"dis-table"},[o("tr",[o("th",[t._v("商品名称")]),t._v(" "),o("th",[t._v("商品售价")]),t._v(" "),o("th",[t._v(t._s(1==t.formData.promote.promoteType?"设置折扣":"设置一口价"))]),t._v(" "),o("th",[t._v("限购数量")]),t._v(" "),o("th",[t._v("操作")])]),t._v(" "),t._l(t.discountData,function(e,r){return o("tr",{key:r},[o("td",{staticStyle:{width:"40%"}},[o("div",{staticClass:"dis-img"},[o("img",{attrs:{src:t.$cms.filterUrl(e.product.coverImage),alt:""}})]),t._v(" "),o("div",{staticClass:"dis-name"},[t._v("\n                  "+t._s(e.product.name)+"\n                ")])]),t._v(" "),o("td",[t._v("\n                "+t._s(t.$cms.float(e.product.salePrice))+"元\n              ")]),t._v(" "),o("td",[1==t.formData.promote.promoteType?o("el-input-number",{attrs:{precision:1,size:"mini",step:.1,max:10,min:.1},model:{value:e.product.discount,callback:function(o){t.$set(e.product,"discount",o)},expression:"item.product.discount"}}):o("el-input-number",{attrs:{precision:1,size:"mini",step:1,max:999999,min:.1},model:{value:e.product.specialPrice,callback:function(o){t.$set(e.product,"specialPrice",o)},expression:"item.product.specialPrice"}})],1),t._v(" "),o("td",[o("el-input-number",{attrs:{step:1,size:"mini",max:99,min:1},model:{value:e.product.limitNum,callback:function(o){t.$set(e.product,"limitNum",o)},expression:"item.product.limitNum"}})],1),t._v(" "),o("td",{staticStyle:{cursor:"pointer"},on:{click:function(e){t.deleteDiscountData(r)}}},[t._v("删除")])])})],2):t._e()],1)],1):t._e(),t._v(" "),3==t.formData.promote.promoteType?o("div",[o("el-form-item",{staticClass:"default",attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-radio-group",{model:{value:t.formData.promote.conType,callback:function(e){t.$set(t.formData.promote,"conType",e)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conOrderAmount,callback:function(e){t.$set(t.formData.promote,"conOrderAmount",e)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[t._v("满")]),t._v(" "),o("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),o("el-radio",{attrs:{label:2}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conOrderAmount,callback:function(e){t.$set(t.formData.promote,"conOrderAmount",e)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[t._v("每满")]),t._v(" "),o("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),t._v(" "),3==t.formData.promote.promoteType?o("el-form-item",{staticClass:"default",attrs:{label:"促销方式",prop:"promote.discountAmount"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.discountAmount,callback:function(e){t.$set(t.formData.promote,"discountAmount",t._n(e))},expression:"formData.promote.discountAmount"}},[o("template",{slot:"prepend"},[t._v("减")]),t._v(" "),o("template",{slot:"append"},[t._v("元")])],2)],1):t._e()],1):t._e(),t._v(" "),4==t.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动优惠券"}},[o("cms-coupon",{attrs:{disabled:!0},model:{value:t.formData.couponIds,callback:function(e){t.$set(t.formData,"couponIds",e)},expression:"formData.couponIds"}})],1)],1):t._e(),t._v(" "),5==t.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-radio-group",{model:{value:t.formData.promote.conType,callback:function(e){t.$set(t.formData.promote,"conType",e)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conOrderAmount,callback:function(e){t.$set(t.formData.promote,"conOrderAmount",e)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[t._v("满")]),t._v(" "),o("template",{slot:"append"},[t._v("元")])],2)],1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"促销方式"}},[o("el-radio-group",{model:{value:t.formData.promote.discountMode,callback:function(e){t.$set(t.formData.promote,"discountMode",e)},expression:"formData.promote.discountMode"}},[o("el-radio",{attrs:{label:2}},[t._v("\n              赠品\n            ")]),t._v(" "),o("el-radio",{attrs:{label:3}},[t._v("\n              优惠券\n            ")])],1)],1),t._v(" "),3==t.formData.promote.discountMode?o("el-form-item",{attrs:{label:"选择优惠券"}},[o("cms-coupon",{attrs:{label:"选择赠品",disabled:!0},model:{value:t.formData.giveCouponIds,callback:function(e){t.$set(t.formData,"giveCouponIds",e)},expression:"formData.giveCouponIds"}})],1):t._e(),t._v(" "),2==t.formData.promote.discountMode?o("el-form-item",{attrs:{label:"选择商品"}},[o("cms-product",{attrs:{type:"product"},model:{value:t.formData.giveProductIds,callback:function(e){t.$set(t.formData,"giveProductIds",e)},expression:"formData.giveProductIds"}})],1):t._e()],1):t._e(),t._v(" "),6==t.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:t.formData.promote.conOrderAmount,callback:function(e){t.$set(t.formData.promote,"conOrderAmount",e)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[t._v("满")]),t._v(" "),o("template",{slot:"append"},[t._v("元")])],2)],1)],1):t._e(),t._v(" "),o("el-form-item",{ref:"promote.enable",attrs:{label:"是否上线",prop:"promote.enable"}},[o("cms-switch",{model:{value:t.formData.promote.enable,callback:function(e){t.$set(t.formData.promote,"enable",e)},expression:"formData.promote.enable"}})],1)],1),t._v(" "),o("div",{staticClass:"cms-form-footer"},[o("cms-button",{directives:[{name:"color",rawName:"v-color"}],on:{click:function(e){t.save(!1)}}},[t._v("保存并新增")]),t._v(" "),o("cms-button",{directives:[{name:"color",rawName:"v-color"}],on:{click:function(e){t.save(!0)}}},[t._v("保存")]),t._v(" "),o("cms-button",{attrs:{type:"rest"},on:{click:t.restData}},[t._v("重置")])],1)],1)],1)},staticRenderFns:[]};var f=o("C7Lr")(u,d,!1,function(t){o("y+mt")},"data-v-5098b60e",null);e.default=f.exports},"y+mt":function(t,e){}});
//# sourceMappingURL=58.e751cd7a7df523f9b03c.js.map