webpackJsonp([68],{VD0K:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("aA9S"),a=o.n(r),m=o("x1ym"),c=o("lcoF"),p=o("QkjJ"),n=o("CPCM"),i=o("FemL"),s=o("q8bx"),l={promote:{name:"",promoteBeginTime:"",promoteEndTime:"",conType:1,promoteScope:1,discountMode:2,conOrderAmount:1,discountAmount:1,remark:"",conProductNum:0,enable:!0,promoteType:3},products:[{specialPrice:"",productId:"",discount:"",limitNum:""}],ctgIds:[],includeProductIds:[],includeProducts:[],excludeProductIds:[],excludeProducts:[],giveProducts:[],giveCouponIds:[],giveCoupons:[],coupons:[],couponIds:[]},d={components:{categoryCascader:n.a,cmsCoupon:i.a,cmsProduct:s.a},mixins:[c.a],data:function(){var e=this;return{storeServices:[],productLimt:[],activeTimer:[],proStatus:!1,formData:a()({},l),rules:{"promote.name":[m.a.required("请填写活动名称"),m.a.len(1,15)],"promote.promoteBeginTime":[m.a.required("请选择活动开始时间","change")],"promote.promoteScope":[m.a.required()],"promote.promoteType":[m.a.required("此项必填","change")],"promote.conOrderAmount":[m.a.number()],"promote.discountAmount":[m.a.integer(),m.a.custom(function(t,o,r){o>e.formData.promote.conOrderAmount?r(new Error("优惠金额不得大于满值金额")):r()})],"promote.conProductNum":[m.a.required()]}}},methods:{getFormData:function(e){var t=this,o={};Object(p.b)({id:e}).then(function(e){200===e.code&&(t.activeTimer=[t.$moment(e.data.promoteBeginTime),t.$moment(e.data.promoteEndTime)],o={promote:{name:e.data.name,promoteBeginTime:e.data.promoteBeginTime,promoteEndTime:e.data.promoteEndTime,conType:e.data.conType,promoteScope:e.data.promoteScope,discountMode:e.data.discountMode,conOrderAmount:e.data.conOrderAmount,discountAmount:e.data.discountAmount,remark:e.data.remark,conProductNum:e.data.conProductNum,enable:e.data.enable,promoteType:e.data.promoteType,id:e.data.id},products:e.data.singleDiscountProducts,ctgIds:e.data.ctgs.map(function(e){return e.id}),includeProductIds:e.data.includeProductIds,includeProducts:[],excludeProductIds:e.data.excludeProductIds,excludeProducts:[],giveProducts:[],giveCoupons:e.data.giveCoupons,giveCouponIds:e.data.giveCouponIds,id:e.data.id,coupons:e.data.coupons,couponIds:[]},e.data.coupons.forEach(function(e){o.couponIds.push(e.id)}),e.data.giveProducts.forEach(function(e){var t={product:{coverImage:e.coverImage,id:e.id,name:e.name,salePrice:e.salePrice}};o.giveProducts.push(t)}),e.data.excludeProducts.forEach(function(e){var t={product:{coverImage:e.coverImage,id:e.id,name:e.name,salePrice:e.salePrice}};o.excludeProducts.push(t)}),e.data.includeProducts.forEach(function(e){var t={product:{coverImage:e.coverImage,id:e.id,name:e.name,salePrice:e.salePrice}};o.includeProducts.push(t)}),t.formData=a()({},o),t.restSel())})},changePromoteType:function(e){1===e&&(this.formData.promote.promoteScope=1),6===e&&(this.formData.promote.conType=1)},deleteDiscountData:function(e){this.formData.products.splice(e,1)},restSel:function(e){var t=this;this.proStatus=!1,setTimeout(function(){t.proStatus=!0},1)},getProductDiscount:function(e){var t=[];e.forEach(function(e){var o={product:{coverImage:e.product.coverImage,id:e.product.id,name:e.product.name,salePrice:e.product.salePrice,specialPrice:e.product.salePrice,discount:9.5,limitNum:1}};t.push(o)}),this.formData.products=t},getStoreService:function(){var e=this;Object(p.v)().then(function(t){200===t.code&&(e.storeServices=t.data)})},serFilter:function(e){return["","单品折扣","单品一口价","满减","优惠券","满赠","包邮"][parseInt(e)]},getActiveTimer:function(e){this.formData.promote.promoteBeginTime=e[0],this.formData.promote.promoteEndTime=e[1]},update:function(e){var t=this.$cms.deepCopy(this.formData);if(t.promote.promoteType<=2){var o=[];this.formData.products.forEach(function(e){var r={specialPrice:2===t.promote.promoteType?e.specialPrice:"",productId:e.product.id,discount:1===t.promote.promoteType?e.discount:"",limitNum:e.limitNum};o.push(r)}),t.products=o}delete t.coupons,this.updateForm(p.h,t,"/storeActivity/list","list")}},created:function(){this.getFormData(this.$route.query.id),this.getStoreService()}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("cms-breadcrumb",{attrs:{to:"/storeActivity/list",type:"list"},on:{click:e.rest}},[o("li",[e._v(e._s(e.$route.name))])]),e._v(" "),o("div",{staticClass:"cms-form-layout"},[o("cms-prompt",{attrs:{collapse:!1}},[o("li",[e._v("可进行修改商家活动")])]),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.formData,"label-width":"210px"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",{ref:"promote_name",attrs:{label:"活动名称",prop:"promote.name"}},[o("el-input",{model:{value:e.formData.promote.name,callback:function(t){e.$set(e.formData.promote,"name",t)},expression:"formData.promote.name"}})],1),e._v(" "),o("el-form-item",{ref:"promote.promoteBeginTime",attrs:{label:"活动时间",prop:"promote.promoteBeginTime",error:e.errorMessage["promote.promoteBeginTime"]}},[o("cms-picker",{staticStyle:{width:"380px"},attrs:{disabledType:"before"},on:{change:e.getActiveTimer},model:{value:e.activeTimer,callback:function(t){e.activeTimer=t},expression:"activeTimer"}})],1),e._v(" "),o("el-form-item",{ref:"promote.remark",attrs:{label:"活动说明",prop:"promote.remark"}},[o("el-input",{attrs:{type:"textarea",rows:4,maxlength:"100"},model:{value:e.formData.promote.remark,callback:function(t){e.$set(e.formData.promote,"remark",t)},expression:"formData.promote.remark"}})],1),e._v(" "),o("el-form-item",{ref:"promote.promoteType",attrs:{label:"活动支持优惠形式",prop:"promote.promoteType"}},[o("el-select",{attrs:{"no-data-text":"暂无可用活动类型，请前往营销服务开通"},on:{change:e.changePromoteType},model:{value:e.formData.promote.promoteType,callback:function(t){e.$set(e.formData.promote,"promoteType",t)},expression:"formData.promote.promoteType"}},e._l(e.storeServices,function(t,r){return o("el-option",{key:r,attrs:{label:e.serFilter(t.promoteType),value:t.promoteType}})}),1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.formData.promote.promoteType>2,expression:"(formData.promote.promoteType>2)"}],ref:"promote.promoteScope",attrs:{label:"活动商品",prop:"promote.promoteScope"}},[o("el-radio-group",{on:{change:e.restSel},model:{value:e.formData.promote.promoteScope,callback:function(t){e.$set(e.formData.promote,"promoteScope",t)},expression:"formData.promote.promoteScope"}},[o("el-radio",{attrs:{label:1}},[e._v("全部商品")]),e._v(" "),o("el-radio",{attrs:{label:2}},[e._v("部分类目")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("部分商品")]),e._v(" "),o("el-radio",{attrs:{label:4}},[e._v("排除商品")])],1)],1),e._v(" "),o("el-form-item",{directives:[{name:"show",rawName:"v-show",value:2===e.formData.promote.promoteScope,expression:"formData.promote.promoteScope===2"}],attrs:{label:"选择类目"}},[o("category-cascader",{staticStyle:{width:"380px"},model:{value:e.formData.ctgIds,callback:function(t){e.$set(e.formData,"ctgIds",t)},expression:"formData.ctgIds"}})],1),e._v(" "),3===e.formData.promote.promoteScope&&e.formData.promote.promoteType>2?o("el-form-item",{attrs:{label:"选择商品"}},[e.proStatus?o("cms-product",{attrs:{data:e.formData.includeProducts,type:"product"},model:{value:e.formData.includeProductIds,callback:function(t){e.$set(e.formData,"includeProductIds",t)},expression:"formData.includeProductIds"}}):e._e()],1):e._e(),e._v(" "),4===e.formData.promote.promoteScope&e.formData.promote.promoteType>2?o("el-form-item",{attrs:{label:"选择商品"}},[e.proStatus?o("cms-product",{attrs:{data:e.formData.excludeProducts,type:"product"},model:{value:e.formData.excludeProductIds,callback:function(t){e.$set(e.formData,"excludeProductIds",t)},expression:"formData.excludeProductIds"}}):e._e()],1):e._e(),e._v(" "),e.formData.promote.promoteType<=2?o("div",[o("el-form-item",{staticClass:"default",attrs:{label:"活动条件",prop:"promote.conProductNum"}},[o("el-radio-group",{model:{value:e.formData.promote.conType,callback:function(t){e.$set(e.formData.promote,"conType",t)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conProductNum,callback:function(t){e.$set(e.formData.promote,"conProductNum",t)},expression:"formData.promote.conProductNum"}},[o("template",{slot:"prepend"},[e._v("满")]),e._v(" "),o("template",{slot:"append"},[e._v("件")])],2)],1),e._v(" "),o("el-radio",{attrs:{label:3}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conProductNum,callback:function(t){e.$set(e.formData.promote,"conProductNum",t)},expression:"formData.promote.conProductNum"}},[o("template",{slot:"prepend"},[e._v("第")]),e._v(" "),o("template",{slot:"append"},[e._v("件")])],2)],1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:1==e.formData.promote.promoteType?"设置折扣":"设置一口价"}},[e.proStatus?o("cms-product",{attrs:{type:"product",show:!1},on:{get:e.getProductDiscount}}):e._e(),e._v(" "),e.formData.products.length>0?o("table",{staticClass:"dis-table"},[o("tr",[o("th",[e._v("商品名称")]),e._v(" "),o("th",[e._v("商品售价")]),e._v(" "),o("th",[e._v(e._s(1==e.formData.promote.promoteType?"设置折扣":"设置一口价"))]),e._v(" "),o("th",[e._v("限购数量")]),e._v(" "),o("th",[e._v("操作")])]),e._v(" "),e._l(e.formData.products,function(t,r){return o("tr",{key:r},[o("td",{staticStyle:{width:"40%"}},[o("div",{staticClass:"dis-img"},[o("img",{attrs:{src:e.$cms.filterUrl(t.product.coverImage),alt:""}})]),e._v(" "),o("div",{staticClass:"dis-name"},[e._v("\n                  "+e._s(t.product.name)+"\n                ")])]),e._v(" "),o("td",[e._v("\n                "+e._s(e.$cms.float(t.product.salePrice))+"元\n              ")]),e._v(" "),o("td",[1==e.formData.promote.promoteType?o("el-input-number",{attrs:{precision:1,size:"mini",step:.1,max:10,min:.1},model:{value:t.discount,callback:function(o){e.$set(t,"discount",o)},expression:"item.discount"}}):o("el-input-number",{attrs:{precision:1,size:"mini",step:1,max:999999,min:.1},model:{value:t.specialPrice,callback:function(o){e.$set(t,"specialPrice",o)},expression:"item.specialPrice"}})],1),e._v(" "),o("td",[o("el-input-number",{attrs:{step:1,size:"mini",max:99,min:1},model:{value:t.limitNum,callback:function(o){e.$set(t,"limitNum",o)},expression:"item.limitNum"}})],1),e._v(" "),o("td",{staticStyle:{cursor:"pointer"},on:{click:function(t){e.deleteDiscountData(r)}}},[e._v("删除")])])})],2):e._e()],1)],1):e._e(),e._v(" "),3==e.formData.promote.promoteType?o("div",[o("el-form-item",{staticClass:"default",attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-radio-group",{model:{value:e.formData.promote.conType,callback:function(t){e.$set(e.formData.promote,"conType",t)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conOrderAmount,callback:function(t){e.$set(e.formData.promote,"conOrderAmount",t)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[e._v("满")]),e._v(" "),o("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),o("el-radio",{attrs:{label:2}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conOrderAmount,callback:function(t){e.$set(e.formData.promote,"conOrderAmount",t)},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[e._v("每满")]),e._v(" "),o("template",{slot:"append"},[e._v("元")])],2)],1)],1)],1),e._v(" "),3==e.formData.promote.promoteType?o("el-form-item",{staticClass:"default",attrs:{label:"促销方式",prop:"promote.discountAmount"}},[o("el-input",{staticStyle:{width:"200px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.discountAmount,callback:function(t){e.$set(e.formData.promote,"discountAmount",t)},expression:"formData.promote.discountAmount"}},[o("template",{slot:"prepend"},[e._v("减")]),e._v(" "),o("template",{slot:"append"},[e._v("元")])],2)],1):e._e()],1):e._e(),e._v(" "),4==e.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动优惠券"}},[o("cms-coupon",{attrs:{disabled:!0,data:e.formData.coupons},model:{value:e.formData.couponIds,callback:function(t){e.$set(e.formData,"couponIds",t)},expression:"formData.couponIds"}})],1)],1):e._e(),e._v(" "),5==e.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-radio-group",{model:{value:e.formData.promote.conType,callback:function(t){e.$set(e.formData.promote,"conType",t)},expression:"formData.promote.conType"}},[o("el-radio",{attrs:{label:1}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conOrderAmount,callback:function(t){e.$set(e.formData.promote,"conOrderAmount",e._n(t))},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[e._v("满")]),e._v(" "),o("template",{slot:"append"},[e._v("元")])],2)],1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"促销方式"}},[o("el-radio-group",{model:{value:e.formData.promote.discountMode,callback:function(t){e.$set(e.formData.promote,"discountMode",t)},expression:"formData.promote.discountMode"}},[o("el-radio",{attrs:{label:2}},[e._v("\n              赠品\n            ")]),e._v(" "),o("el-radio",{attrs:{label:3}},[e._v("\n              优惠券\n            ")])],1)],1),e._v(" "),3==e.formData.promote.discountMode?o("el-form-item",{attrs:{label:"选择优惠券"}},[o("cms-coupon",{attrs:{label:"选择赠品",disabled:!0,data:e.formData.giveCoupons},model:{value:e.formData.giveCouponIds,callback:function(t){e.$set(e.formData,"giveCouponIds",t)},expression:"formData.giveCouponIds"}})],1):e._e(),e._v(" "),2==e.formData.promote.discountMode?o("el-form-item",{attrs:{label:"选择商品"}},[e.proStatus?o("cms-product",{attrs:{type:"product",data:e.formData.giveProducts},model:{value:e.formData.giveProductIds,callback:function(t){e.$set(e.formData,"giveProductIds",t)},expression:"formData.giveProductIds"}}):e._e()],1):e._e()],1):e._e(),e._v(" "),6==e.formData.promote.promoteType?o("div",[o("el-form-item",{attrs:{label:"活动条件",prop:"promote.conOrderAmount"}},[o("el-input",{staticStyle:{width:"180px"},attrs:{maxlength:"5"},model:{value:e.formData.promote.conOrderAmount,callback:function(t){e.$set(e.formData.promote,"conOrderAmount",e._n(t))},expression:"formData.promote.conOrderAmount"}},[o("template",{slot:"prepend"},[e._v("满")]),e._v(" "),o("template",{slot:"append"},[e._v("元")])],2)],1)],1):e._e(),e._v(" "),o("el-form-item",{ref:"promote.enable",attrs:{label:"是否上线",prop:"promote.enable"}},[o("cms-switch",{model:{value:e.formData.promote.enable,callback:function(t){e.$set(e.formData.promote,"enable",t)},expression:"formData.promote.enable"}})],1)],1),e._v(" "),o("div",{staticClass:"cms-form-footer"},[o("cms-button",{directives:[{name:"color",rawName:"v-color"}],on:{click:function(t){e.update(!1)}}},[e._v("修改")])],1)],1)],1)},staticRenderFns:[]};var f=o("C7Lr")(d,u,!1,function(e){o("m4f0")},"data-v-28005130",null);t.default=f.exports},m4f0:function(e,t){}});
//# sourceMappingURL=68.51c8e31ae61e898fa944.js.map