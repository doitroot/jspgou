webpackJsonp([71],{KMwx:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("aA9S"),i=r.n(o),a=r("x1ym"),n=r("lcoF"),m=r("QkjJ"),s=r("CPCM"),l=r("FemL"),u=r("q8bx"),c={promote:{name:"",promoteBeginTime:"",promoteEndTime:"",remark:"",enable:!1,promoteType:"",product_flag_icon:""},rule:{signBeginTime:"",signEndTime:"",signScope:"",oneFeeThird:"",oneFeeSelf:"",maxRefundRate:"",minPrice:"",minSale:"",minScore:"",minStock:""},discounts:[{conOrderAmount:0,discountAmount:0}],signLimitCtgIds:[],couponIds:[]},d={components:{categoryCascader:s.a,cmsCoupon:l.a,cmsProduct:u.a},mixins:[n.a],data:function(){return{coupons:[],productLimt:[],activeTimer:[],signTimer:[],formData:i()({},c),signData:{id:this.$route.query.id,productIds:[]},checkedProductData:[],rules:{productIds:[a.a.required("至少选择一件商品")]}}},methods:{getSignData:function(e){var t=this;Object(m.n)({promoteId:e}).then(function(e){200===e.code&&(t.checkedProductData=e.data.products)})},getFormData:function(e){var t=this;this.status=!1,this.loading=!0,Object(m.d)({id:e}).then(function(e){200===e.code?(t.copyData(e.data),t.status=!0,t.loading=!1):t.loading=!1}).catch(function(e){t.loading=!1})},copyData:function(e){var t=this.formData.promote,r=this.formData.rule;t.id=e.id,t.name=e.name,t.promoteBeginTime=this.$moment(e.promoteBeginTime,"YYYY-MM-DD"),t.promoteEndTime=this.$moment(e.promoteEndTime,"YYYY-MM-DD"),this.activeTimer=[t.promoteBeginTime,t.promoteEndTime],t.remark=e.remark,t.enable=e.enable,t.promoteType=e.promoteType,r.signBeginTime=this.$moment(e.rule.signBeginTime,"YYYY-MM-DD"),r.signEndTime=this.$moment(e.rule.signEndTime,"YYYY-MM-DD"),this.signTimer=[r.signBeginTime,r.signEndTime],r.signScope=e.rule.signScope,r.oneFeeThird=e.rule.oneFeeThird,r.oneFeeSelf=e.rule.oneFeeSelf,r.maxRefundRate=e.rule.maxRefundRate,r.id=e.id,e.rule.minPrice>1&&this.productLimt.push(parseInt(1)),e.rule.minStock>2&&this.productLimt.push(parseInt(2)),e.rule.minScore>3&&this.productLimt.push(parseInt(3)),e.rule.maxRefundRate>4&&this.productLimt.push(parseInt(4)),e.rule.minSale>5&&this.productLimt.push(parseInt(5)),r.minPrice=e.rule.minPrice,r.minSale=e.rule.minSale,r.minScore=e.rule.minScore,r.minStock=e.rule.minStock,this.formData.discounts=e.discounts,e.rule.ctgs&&e.rule.ctgs.length>0&&(this.formData.signLimitCtgIds=e.rule.ctgs.map(function(e){return e.id})),e.coupons&&e.coupons.length>0&&(this.coupons=e.coupons,this.formData.couponIds=e.coupons.map(function(e){return e.id}))},signPromote:function(){var e=this;this.$refs.form.validate(function(t,r){if(!t)return!1;Object(m.u)(e.signData).then(function(t){200===t.code?(e.$successMessage("报名成功"),setTimeout(function(){e.$routerLink("/platformActivity/list")},1e3)):e.$errorMessage(t.message)})})}},created:function(){this.getSignData(this.$route.query.id),this.getFormData(this.$route.query.id)}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("cms-breadcrumb",{attrs:{to:"/platformActivity/list",type:"list"},on:{click:e.rest}},[r("li",[e._v(e._s(e.$route.name))])]),e._v(" "),r("div",{staticClass:"cms-form-layout"},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{rules:e.rules,model:e.signData,"label-width":"210px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{ref:"promote_name",attrs:{label:"活动名称"}},[e._v("\n        "+e._s(e.formData.promote.name)+"\n      ")]),e._v(" "),r("el-form-item",{ref:"promote.promoteBeginTime",attrs:{label:"活动时间",error:e.errorMessage["promote.promoteBeginTime"]}},[e._v("\n        "+e._s(e.activeTimer[0])+" 至 "+e._s(e.activeTimer[1])+"\n      ")]),e._v(" "),r("el-form-item",{ref:"rule.signBeginTime",attrs:{label:"报名时间",error:e.errorMessage["rule.signBeginTime"]}},[e._v("\n        "+e._s(e.signTimer[0])+" 至 "+e._s(e.signTimer[1])+"\n      ")]),e._v(" "),r("el-form-item",{ref:"promote.remark",attrs:{label:"活动说明"}},[e._v("\n        "+e._s(e.formData.promote.remark)+"\n      ")]),e._v(" "),r("el-form-item",{ref:"rule_signScope",attrs:{label:"活动报名限制"}},[1==e.formData.rule.signScope?r("span",[e._v("全部商品")]):e._e(),e._v(" "),2==e.formData.rule.signScope?r("span",[e._v("自营商品")]):e._e(),e._v(" "),3==e.formData.rule.signScope?r("span",[e._v("部分类目")]):e._e()]),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===e.formData.rule.signScope,expression:"formData.rule.signScope===3"}],attrs:{label:"选择类目"}},[r("category-cascader",{staticStyle:{width:"380px"},model:{value:e.formData.signLimitCtgIds,callback:function(t){e.$set(e.formData,"signLimitCtgIds",t)},expression:"formData.signLimitCtgIds"}})],1),e._v(" "),r("el-form-item",{ref:"promote.promoteType",attrs:{label:"活动支持优惠形式"}},[4==e.formData.promote.promoteType?r("span",[e._v("优惠券")]):e._e(),e._v(" "),3==e.formData.promote.promoteType?r("span",[e._v("满减")]):e._e()]),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:4==e.formData.promote.promoteType,expression:"formData.promote.promoteType==4"}],attrs:{label:"选择优惠券"}},[r("cms-coupon",{attrs:{disEdit:!0,data:e.coupons},model:{value:e.formData.couponIds,callback:function(t){e.$set(e.formData,"couponIds",t)},expression:"formData.couponIds"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3==e.formData.promote.promoteType,expression:"formData.promote.promoteType==3"}],attrs:{label:"满减信息"}},[r("ul",e._l(e.formData.discounts,function(t,o){return r("li",{key:o,staticStyle:{"margin-bottom":"10px"}},[e._v("\n            满 "+e._s(t.conOrderAmount)+"\n            减 "+e._s(t.discountAmount)+"\n          ")])}),0)]),e._v(" "),r("el-form-item",{ref:"rule.oneFeeThird",attrs:{label:"自营店铺单品收费"}},[e._v("\n        "+e._s(e.$cms.float(e.formData.rule.oneFeeThird))+"元\n      ")]),e._v(" "),r("el-form-item",{ref:"rule.oneFeeSelf",attrs:{label:"非自营店铺单品收费"}},[e._v("\n        "+e._s(e.$cms.float(e.formData.rule.oneFeeSelf))+"元\n      ")]),e._v(" "),e.productLimt.indexOf(1)>-1?r("el-form-item",{ref:"rule.minPrice",attrs:{label:"最新30天成交价>="}},[e._v("\n        "+e._s(e.$cms.float(e.formData.rule.minPrice))+"元\n      ")]):e._e(),e._v(" "),e.productLimt.indexOf(2)>-1?r("el-form-item",{ref:"rule.minStock",attrs:{label:"库存>="}},[e._v("\n        "+e._s(e.$cms.float(e.formData.rule.minStock))+"元\n      ")]):e._e(),e._v(" "),e.productLimt.indexOf(3)>-1?r("el-form-item",{ref:"rule.minScore",attrs:{label:"商品评分>="}},[e._v("\n        "+e._s(e.$cms.float(e.formData.rule.minScore))+"元\n      ")]):e._e(),e._v(" "),e.productLimt.indexOf(4)>-1?r("el-form-item",{ref:"rule.maxRefundRate",attrs:{label:"退款率<="}},[e._v("\n        "+e._s(e.formData.rule.maxRefundRate)+"%\n      ")]):e._e(),e._v(" "),e.productLimt.indexOf(5)>-1?r("el-form-item",{ref:"rule.minSale",attrs:{label:"最新30天销量>="}},[e._v("\n        "+e._s(e.formData.rule.minSale)+"件\n      ")]):e._e(),e._v(" "),"save"==e.$route.query.type?r("div",[r("h3",{staticClass:"cms-segmentation"},[e._v("活动报名")]),e._v(" "),r("el-form-item",{attrs:{label:"选择报名商品",prop:"productIds"}},[r("cms-product",{attrs:{promoteId:e.$route.query.id,data:e.checkedProductData},model:{value:e.signData.productIds,callback:function(t){e.$set(e.signData,"productIds",t)},expression:"signData.productIds"}})],1),e._v(" "),r("el-form-item",{attrs:{label:""}},[r("el-button",{attrs:{type:"primary"},on:{click:e.signPromote}},[e._v("报名")])],1)],1):e._e()],1)],1)],1)},staticRenderFns:[]};var f=r("C7Lr")(d,p,!1,function(e){r("OmKd")},"data-v-2347b8a7",null);t.default=f.exports},OmKd:function(e,t){}});
//# sourceMappingURL=71.e93bcf78a095d968df73.js.map